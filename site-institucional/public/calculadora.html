<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plantação de café</title>
  <!-- Estilos -->
  <link rel="stylesheet" href="./css/globais.css">
  <link rel="stylesheet" href="./css/calculadora.css">
  <link rel="stylesheet" href="./css/componentes.css">

  <!-- Fontes -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100&display=swap" rel="stylesheet">
  <!-- Favicon -->
  <link rel="shortcut icon" href="./assets/images/LOGO_PNG.png" type="image/x-icon">
  <!-- Scripts -->
  <script src="./js/helpers.js">
  </script>
</head>

<body>
  <div class="header">
    <div class="container">
      <div class="imagens">
        <a href="./index.html">
          <img class="logo" src="./assets/images/LOGO_PNG.png" alt="">
        </a>
      </div>
      <ul class="navbar">
        <li><a href="./index.html">Inicio</a></li>
        <li><a href="#">Simulador</a></li>
        <li><a href="./digitalbook.html">Caderno de Campo Digital</a></li>
        <li><a href="./about.html">Sobre nós</a></li>
      </ul>

      <div class="svg_icons">
        <a href="https://bit.ly/3FLGyjK">
          <svg id="whatsapp" fill="#a0a0a0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="32px"
            height="32px">
            <path fill-rule="evenodd"
              d="M 24.503906 7.503906 C 22.246094 5.246094 19.246094 4 16.050781 4 C 9.464844 4 4.101563 9.359375 4.101563 15.945313 C 4.097656 18.050781 4.648438 20.105469 5.695313 21.917969 L 4 28.109375 L 10.335938 26.445313 C 12.078125 27.398438 14.046875 27.898438 16.046875 27.902344 L 16.050781 27.902344 C 22.636719 27.902344 27.996094 22.542969 28 15.953125 C 28 12.761719 26.757813 9.761719 24.503906 7.503906 Z M 16.050781 25.882813 L 16.046875 25.882813 C 14.265625 25.882813 12.515625 25.402344 10.992188 24.5 L 10.628906 24.285156 L 6.867188 25.269531 L 7.871094 21.605469 L 7.636719 21.230469 C 6.640625 19.648438 6.117188 17.820313 6.117188 15.945313 C 6.117188 10.472656 10.574219 6.019531 16.054688 6.019531 C 18.707031 6.019531 21.199219 7.054688 23.074219 8.929688 C 24.949219 10.808594 25.980469 13.300781 25.980469 15.953125 C 25.980469 21.429688 21.523438 25.882813 16.050781 25.882813 Z M 21.496094 18.445313 C 21.199219 18.296875 19.730469 17.574219 19.457031 17.476563 C 19.183594 17.375 18.984375 17.328125 18.785156 17.625 C 18.585938 17.925781 18.015625 18.597656 17.839844 18.796875 C 17.667969 18.992188 17.492188 19.019531 17.195313 18.871094 C 16.894531 18.722656 15.933594 18.40625 14.792969 17.386719 C 13.90625 16.597656 13.304688 15.617188 13.132813 15.320313 C 12.957031 15.019531 13.113281 14.859375 13.261719 14.710938 C 13.398438 14.578125 13.5625 14.363281 13.710938 14.1875 C 13.859375 14.015625 13.910156 13.890625 14.011719 13.691406 C 14.109375 13.492188 14.058594 13.316406 13.984375 13.167969 C 13.910156 13.019531 13.3125 11.546875 13.0625 10.949219 C 12.820313 10.367188 12.574219 10.449219 12.390625 10.4375 C 12.21875 10.429688 12.019531 10.429688 11.820313 10.429688 C 11.621094 10.429688 11.296875 10.503906 11.023438 10.804688 C 10.75 11.101563 9.980469 11.824219 9.980469 13.292969 C 9.980469 14.761719 11.050781 16.183594 11.199219 16.382813 C 11.347656 16.578125 13.304688 19.59375 16.300781 20.886719 C 17.011719 21.195313 17.566406 21.378906 18 21.515625 C 18.714844 21.742188 19.367188 21.710938 19.882813 21.636719 C 20.457031 21.550781 21.648438 20.914063 21.898438 20.214844 C 22.144531 19.519531 22.144531 18.921875 22.070313 18.796875 C 21.996094 18.671875 21.796875 18.597656 21.496094 18.445313 Z" />
          </svg>
        </a>

        <a href="mailto:gustavo.moliveira@bandtec.com.br">
          <svg id="email" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
            <path
              d="M0 3v18h24v-18h-24zm21.518 2l-9.518 7.713-9.518-7.713h19.036zm-19.518 14v-11.817l10 8.104 10-8.104v11.817h-20z" />
          </svg>
        </a>
        <div>
          <a href="">
            <svg id="user" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
              x="0px" y="0px" viewBox="0 0 32 32" style="enable-background:new 0 0 32 32;" xml:space="preserve">
              <style type="text/css">
                .st0 {
                  fill: none;
                  stroke: #a0a0a0;
                  stroke-width: 2;
                  stroke-linecap: round;
                  stroke-linejoin: round;
                  stroke-miterlimit: 10;
                }

                .st1 {
                  fill: none;
                  stroke: #000000;
                  stroke-width: 2;
                  stroke-linejoin: round;
                  stroke-miterlimit: 10;
                }
              </style>
              <circle class="st0 hover" cx="16" cy="16" r="14" />
              <circle class="st0 hover" cx="16" cy="13" r="5" />
              <path class="st0 hover" d="M5.4,25.1c1.8-4.1,5.8-7,10.6-7c4.8,0,8.9,2.9,10.6,7" />
            </svg>
          </a>

          <div id='dropdown'>
            <div id="dropdown2">
              <a id="a_login" href="./login.html">Login</a>
              <span style="color: #a0a0a0;">|</span>
              <a id="a_register" href="./register.html">Cadastro</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="form">
    <h2>Calculadora</h2>
    <label for="txtHectares">Hectares da plantação</label>
    <input id="txtHectares" type="text">
    <label for="txtCep">CEP</label>
    <input id="txtCep" type="text" maxlength="8" oninput="maskCEP(this.value, txtCep)" />
    <label for="txtLogradouro">Lougradouro</label>
    <input id="txtLogradouro" type="text" readonly />
    <label for="txtBairro">Bairro</label>
    <input id="txtBairro" type="text" readonly />
    <label for="txtAltitude">Altitude</label>
    <input id="txtAltitude" type="text" readonly />
    &nbsp;
    <button type="button" onclick="calcular()">Prosseguir</button>
  </div>
  <div id="result" style="display: none;">
    <h2>A média de temperatura de mínima e máxima de cada mês no ano que vêm é:</h2>
    <table id="table">
    </table>
    &nbsp;
    <h3>Levando em conta esses dados</h3>
  </div>

  <footer>
    <div class="container">
      <div class="map">
        <h2>Endereço</h2>
        <iframe
          src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3657.2873451596256!2d-46.66380268590562!3d-23.55812128468444!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x94ce59d2b063f663%3A0xc567c0d16d0bc582!2sBandtec%20Digital%20School!5e0!3m2!1spt-BR!2sbr!4v1633209666581!5m2!1spt-BR!2sbr"
          width="360px" height="200px" style="border:0;" loading="lazy"></iframe>
      </div>

      <div class="contact">
        <h2>Horário de funcionamento</h2>

        <p>Segunda a sexta - 9h às 18h</p>
        <p>Sábado - 9h às 12h</p>
        &nbsp;
        <img width="160px" src="./assets/images/logo_black.ico" />
      </div>

    </div>


    <div class="copyright">
      <div class="container">
        <span>&copy;Copyright 2019 | AGROTIS</span>
      </div>
    </div>

  </footer>
</body>

</html>

<script>
  // (async () => {
  //   const res = await fetch(
  //     'https://api.weather.com/v3/wx/almanac/daily/45day?geocode=-23.53%2C-46.62&units=m&startDay=28&startMonth=11&format=json&apiKey=21d8a80b3d6b444998a80b3d6b1449d3'
  //   )
  // })();

  async function calcular() {
    form.style.display = "none";
    const months = {
      0: 'janeiro',
      1: 'fevereiro',
      2: 'março',
      3: 'abril',
      4: 'maio',
      5: 'junho',
      6: 'julho',
      7: 'agosto',
      8: 'setembro',
      9: 'outubro',
      10: 'novembro',
      11: 'dezembro'
    }

    const monthsData = await fetch('http://localhost:3000/api/weather', {
        method: 'GET'
      })
      .then(response => response.json())
      .then(dataParsed => ({
        janeiro: dataParsed.slice(0, 30),
        fevereiro: dataParsed.slice(31, 59),
        marco: dataParsed.slice(60, 90),
        abril: dataParsed.slice(91, 120),
        maio: dataParsed.slice(121, 151),
        junho: dataParsed.slice(152, 181),
        julho: dataParsed.slice(182, 212),
        agosto: dataParsed.slice(213, 243),
        setembro: dataParsed.slice(244, 273),
        outubro: dataParsed.slice(274, 304),
        novembro: dataParsed.slice(305, 334),
        dezembro: dataParsed.slice(335),
      }))

    result.style.display = "flex";

    table.innerHTML = '<th>Mês</th><th>Mínima</th><th>Máxima</th><th>Precipitação</th>'
    const medias = [0, 0, 0]
    console.log(monthsData)
    Object.keys(monthsData).map((month, i) => {
      table.innerHTML +=
        `<tr>
        <td>${month}</td>
        <td>${(Object.values(monthsData)[i].reduce((acc, el) => acc + +el["min"],0) / Object.values(monthsData)[i].length).toFixed(2)}°C</td>
        <td>${(Object.values(monthsData)[i].reduce((acc, el) => acc + +el["max"],0) / Object.values(monthsData)[i].length).toFixed(2)}°C</td>
        <td>${(Object.values(monthsData)[i].reduce((acc, el) => acc + +el["preciptation"],0) / Object.values(monthsData)[i].length).toFixed(2)}mm</td>
      </tr>`

      medias[0] += +(Object.values(monthsData)[i].reduce((acc, el) => acc + +el["min"], 0) / Object.values(
        monthsData)[i].length).toFixed(2)
      medias[1] += +(Object.values(monthsData)[i].reduce((acc, el) => acc + +el["max"], 0) / Object.values(
        monthsData)[i].length).toFixed(2)
      medias[2] += +(Object.values(monthsData)[i].reduce((acc, el) => acc + +el["preciptation"], 0) / Object
        .values(
          monthsData)[i].length).toFixed(2)
    })
    result.innerHTML += `
      <p>Média mínima de temperatura do ano: ${(medias[0] / Object.keys(monthsData).length).toFixed(2)}°C e
      média máxima: ${(medias[1] / Object.keys(monthsData).length).toFixed(2)}°C</p>
    `

    result.innerHTML += `
    <p>${medias[2] < 1500 ? 'Deverá' : 'Não será necessário'} ter irrigação tomando por base que o ideal de média de precipitação deve ser 1500mm e no ano vigente o valor está em ${medias[2].toFixed(2)}mm</p>
    `
    if (medias[0] / Object.keys(monthsData).length < 18) {
      result.innerHTML += `
        <p>Esse ano a temperatura vai estar um pouco baixa! Sugerimos que plante grãos mais resistentes</p>
      `
    } else if (medias[1] / Object.keys(monthsData).length > 24) {
      result.innerHTML += `
        <p>Esse ano a temperatura vai estar um pouco alta! Sugerimos que plante grãos mais resistentes</p>
      `
    } else {
      result.innerHTML += `
        <p>Esse ano vai ser show pra plantar o melhor café!</p>
      `
    }


  }

  document.getElementById('user').addEventListener('click', (e) => {
    e.preventDefault();
    var dropdown = document.getElementById('dropdown')
    if (dropdown.style.display == "flex") {
      dropdown.style.display = "none"
    } else {
      dropdown.style.display = "flex"

    }
  })
</script>